# k8s(一)：基本概念

## 1 K8S概述

* Kubernetes 谷歌2014年开源的容器化集群管理系统
* 容器管理
* 部署容器方式实现，每个容器互相隔离
* 自动化部署
* 使用k8s利于应用拓展
* 目标让容器化应用更加简洁和高效

## 2 K8S功能

1. **自动装箱**

	基于容器对应用运行环境配置要求自动部署应用容器

2. **自我修复（自愈能力）**

	当容器失败时，会对容器进行重启

	当所部署的Node节点有问题时，会对容器进行重新部署和重新调度

	当容器未通过监控检查时，会关闭此容器直到容器正常运行时，才会对外提供服务

	![image-20210127133516333](https://cyzblog.oss-cn-beijing.aliyuncs.com/image-20210127133516333.png)

3. **水平扩展**

	当我们有大量的请求来临时，我们可以增加副本数量，从而达到水平扩展的效果

	![image-20210127133621291](https://cyzblog.oss-cn-beijing.aliyuncs.com/image-20210127133621291.png)

4. **服务发现**

	用户不需使用额外的服务发现机制，就能够基于Kubernetes 自身能力实现服务发现和负载均衡

	对外提供统一的入口，让它来做节点的调度和负载均衡， 相当于微服务里面的网关

	![image-20210127133711124](https://cyzblog.oss-cn-beijing.aliyuncs.com/image-20210127133711124.png)

5. **滚动更新**

	可以根据应用的变化，对应用容器运行的应用，进行一次性或批量式更新

	添加应用的时候，不是加进去就马上可以进行使用，而是需要判断这个添加进去的应用是否能够正常使用

6. **版本回退**

	可以根据应用部署情况，对应用容器运行的应用，进行历史版本即时回退

7. **密码配置管理**

	在不需要重新构建镜像的情况下，可以部署和更新密钥和应用配置，类似热部署。

8. 	**存储编排**

	自动实现存储系统挂载及应用，特别对有状态应用实现数据持久化非常重要

	存储系统可以来自于本地目录、网络存储(NFS、Gluster、Ceph 等)、公共云存储服务

9. 	**批处理**

	提供一次性任务，定时任务；满足批量数据处理和分析的场景

## 3 k8s集群架构组件

### 3.1 架构总览

![image-20210127133957950](https://cyzblog.oss-cn-beijing.aliyuncs.com/image-20210127133957950.png)

* Master 主控节点

	![image-20210127134819829](https://cyzblog.oss-cn-beijing.aliyuncs.com/image-20210127134819829.png)

* node 工作节点

	![image-20210127134838185](https://cyzblog.oss-cn-beijing.aliyuncs.com/image-20210127134838185.png)

### 3.2 架构细节

**master**：主控节点

- API Server：
	- 集群统一入口，以*restful*风格进行操作，同时交给*etcd*存储
	- 提供认证、授权、访问控制、API注册和发现等机制
- scheduler：
	- 节点的调度，选择node节点应用部署
- controller-manager：
	- 处理集群中常规后台任务，一个资源对应一个控制器
- etcd：
	- 存储系统，用于保存集群中的相关数据

**Work node**：工作节点

- Kubelet：master派到node节点代表，管理本机容器
	- 一个集群中每个节点上运行的代理，它保证容器都运行在Pod中
	- 负责维护容器的生命周期，同时也负责Volume(CSI) 和 网络(CNI)的管理
- kube-proxy：提供网络代理，负载均衡等操作

## 4 k8s基本概念

### 4.1 Pod

* 最小部署单元（不是容器、而是Pod）
* 一组容器的集合
* 一个Pod中的容器共享网络
* 生命周期是短暂的（服务器重启后就无了）

### 4.2 controller

* 确保预期的Pod副本数量
* 无状态应用部署
	* 拿过来就能用
* 有状态应用部署
	* 需要特定条件，比如依赖网络和存储
* 确保所有的node运行同一个pod
* 一次性任务和定时任务

### 4.3 Service

* 定义一组pod的访问规则