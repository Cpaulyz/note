## chapter1

### 起源

* 知识值链
	* data 抽取 information 解释为 knowledge
* 企业的新问题
	* 数据爆炸而信息贫乏
	* 可访问性、及时性、表达格式、完整性
* **为何需要商务智能？**
	* 许多数据仓库解决方案的共同缺点就是系统的开发者专注于软件技术，而不是商业解决方案
	* 数据仓库产品实施起来复杂
	* 数据仓库产品很少针对特定产业、应用领域提供解决方案
	* 企业需要的是商务解决方案，而不是技术本身
	* 人们过多关系如何建立数据仓库，而不是如何进行访问
	* 许多企业认为他们只需要建立起数据仓库并为用户提供合适的工具。其实这只是个开始
* **商务智能**
	* 目标：决策支持、改善信息访问

### 构件

* 数据源（BI体系中的数据来源）
	* 操作型数据库、历史数据、外部数据、数据仓库中的信息、相关数据库和数据结构等
	* 可以是不同平台，可以是格式化和非格式化
* 数据仓库
	* **ETL**（extract translation load）数据提取、转换、装载
		* 识别与主题相关的原始数据
		* 开发数据抽取策略
		* 将原始数据转换为目标规格
		* 将原始数据加载到预定目标区域
	* 数据管理
		* 存储、索引、备份
	* 数据访问
	* 元数据
		* 元数据是数据的数据，是如何管理数据仓库的重要数据
		* 例如，数据结构、内容、编码、索引、表名等
* 分析和展现层
	* 报表和查询
	* 联机分析处理 OLAP
	* 数据统计
	* 数据挖掘

### 解决方案

### 发展趋势

## chapter2-4 数据仓库

### 操作型处理

* 也叫事务处理，是指对数据库的日常联机访问操作，通常是对一个或一组记录的查询和修改，主要是为企业特定的应用服务的，所以也叫联机事务处理
* OLTP online transaction processing
	* 通常仅仅是是对一个或一组记录的查询或修改
	* 查询简单，但执行频率高
	* 人们关心的是处理的响应时间、数据安全性和完整性等指标

### 分析型处理

* 也叫信息型处理，主要用于企业管理人员的决策分析，为制定企业的未来经营管理计划提供辅助决策信息
	* 需要对大量的事务型数据进行统计、归纳和分析
	* 需要访问大量历史数据
	* 执行频率和对响应时间的要求不高
* 典型的分析型处理
	* DSS decision support system 决策支持系统

### 操作型数据vs分析型数据

* 操作型数据
	* 事务处理所需要的细节性数据，面向企业员工的日常业务处理过程。通常由数据库管理系统负责其存储与管理

* 分析型数据
	* 分析处理所需要的综合性数据，是面向企业管理人员的决策需要的

![image-20210101132616306](https://cyzblog.oss-cn-beijing.aliyuncs.com/image-20210101132616306.png)

### 事务型数据不适合DSS的原因*

* **事务处理和分析处理的特性功能不同**
	* 用户每次操作处理的时间段，存取数据量小，但操作频率高，并发程度大
	* 每次分析可能需要连续运行很长的时间，存取数据量大，但很少做这样的分析处理，也没有并发执行的要求
* **数据集成问题**
	* 事务处理一般只需要与本业务部门有关的当前细节数据
	* 分析处理的数据可能来自多种不同的数据源
	* 对于需要集成数据的DSS应用来说，在应用程序中对事务处理环境中的这些纷繁复杂的数据进行集成，将带来下述问题：     
		- 大大加重程序员的负担
		- 重复计算
		- 极低的分析处理效率
* **数据的动态集成问题**
	* 集成数据必须以一定的周期进行刷新（即采用动态集成策略），**但传统的事务处理并不具备动态集成的能力**
* **历史数据问题**
	* 事务处理一般只需要**当前数据（3~6个月）**
	* 分析处理更看重**历史数据（5~10年）**
* **数据的综合问题**
	* 事务处理需要的是当前的**细节性操作数据**
	* 分析处理需要的往往是大量的**总结性分析型数据**，而非数据库中的细节性操作型数据（数据丰富、信息贫乏）
	* 在分析前往往需要对细节数据进行不同程度的综合，传统的事务处理不具备这种综合能力
* **数据的访问问题**

	- 事务处理对于需要修改的数据必须**实时“更新”数据库**
	- 分析处理以“读”操作为主，不需要实时的“更新”操作，但需要定时刷新

### 数据仓库的定义

数据仓库就是一个面向主题的、集成的、不可更新的、随时间不断变化的数据集合，用于支持经营管理过程中的决策制定

* **面向主题**
	* 主题是较高层次上将企业信息系统中的数据综合、归类并进行分析利用的抽象。在逻辑意义上，是对企业中某一宏观分析领域涉及的分析对象
	* **面向主题是指数据仓库内的信息是按主题进行组织的，为按主题进行决策的过程提供信息**
* **集成**
	* 数据仓库中的数据是为分析服务的，而分析需要多种广泛的不同数据源以便进行比较、鉴别，因此**数据仓库中的数据必须从多个数据源中获取**
* **非易失/稳定的**
	* 执行的主要是“查询操作，一般情况下不执行“更新”操作
* **随时间不断变化**
	* 数据仓库中的数据通常带有时间属性，同时必须以一定时间段为单位进行统一更新
	* 比如，不断增加新的数据内容、删去旧的数据内容、更新与时间有关的综合数据

### 关键技术

* ETL
* 存储和管理
* 数据的访问和表现
* 元数据

### 数据抽取

数据仓库中的数据来源于数据源，将数据源中数据通过网络进行抽取，并经加工、转换、综合后形成数据仓库中的数据，这就 是数据仓库的数据抽取。

> 数据源可以是：
>
> * 不同格式的数据
> * 不同的数据操作平台
> * 不同的物理位置
> * 可以是递归的（另一个数据仓库/数据集市，本数据仓库的分析型应用）
> * 关系型数据库、面向对象数据库、桌面数据库、文件系统、word、excel...

### 数据刷新

- 经过抽取进入数据仓库的数据，在经过一段时间后要重新修正，**修改那些过时的数据，保存那些不变的数据**，此种动作被称为数据仓库的刷新
- 数据刷新的过程与抽取类似，但刷新的数据量往往小于抽取的数据量。
- 由于仅需要对修改过的数据进行刷新，因而其实现难度与复杂性要**大**于数据抽取

### 数据刷新方法

* **时间戳**
	* 适用情况：数据库中的记录有时间属性，可以根据OTLP数据库中的数据有无更新，以及在更新操作时数据的修改时间标志来实现数据仓库数据的动态刷新
	* 缺点：大多数数据库的数据不包含时间属性
* **DELTA文件**
	* 适用情况：有些OLTP数据库的应用程序在工作过程中会形成一些DELTA文件以记录该应用所作的数据修改操作，可根据该DELTA文件进行数据刷新
	* 优点：采用此方法可避免对整个数据库的对比扫描，具有较高的刷新效率
	* 缺点：这样的应用程序并不普遍，修改现有的应用程序的工作量又太大
* **映像文件**
	* 实现方法：在上一次数据刷新后对数据库作一次快照，在本次刷新之前再对数据库作一次快照。比较两个快照的不同，从而确定数据仓库的数据刷新操作
	* 缺点：需要占用大量的系统资源，可能较大地影响原有数据库系统的性能
* **日志文件**
	* 实现方法：一般OLTP数据库都有日志文件，可根据OLTP数据库的日志信息来实现数据仓库的数据刷新
	* 优点：日志是OLTP数据库的固有机制，不会影响原有OLTP数据库的性能，具有比DELTA文件和建立映像文件更高的刷新效率

### 粒度

* 粒度是对数据仓库中数据的综合程度的一个度量，既影响数据仓库中数据量的多少，也影响数据仓库能够回答询问的种类。
* 粒度越小，细节程度越高，综合程度越低，回答查询种类越多，查询效率越低
* **多重粒度**能够应对不同级别的粒度要求
	* 大粒度数据放在快速存储设备中，以提升性能
	* 小粒度数据放在低速存储设备中，以满足细节查询

### 维度&层次

数据仓库是多维度多层次的

* 维度是观察数据对象的角度
* 层次是数据对象的综合程度

### 元数据

* 关于数据的数据，描述了数据的结构、内容、编码、索引等内容
* 通过元数据可以将数据仓库和复杂的数据源系统的变化隔离，是数据仓库开发和维护的一个关键因素，也是保证数据抽取质量的依据
	* 关于数据源的元数据（数据源有哪些，物理数据结构、业务定义）
	* 关于数据模型的元数据（数据仓库有什么数据、数据之间的关系）
	* 与数据仓库映射相关的元数据（数据源到数据仓库的转换规则）
	* 关于数据仓库使用的元数据

### 为什么需要数据集市？

* 早期的数据仓库概念仅仅提供了一个多源数据库的数据集成功能，为最终用户访问多个数据源提供统一的数据视图和访问接口
* 然而，全局数据仓库太大，在实际应用中，将他们按照部门或者个人建立反映各个子主题与区域的局部性数据组织，即是**数据集市**，也称为部门数据仓库
* 例如，在有关商品销售的数据仓库中可以建立多个不同主题的数据集市
	* 商品采购数据集市
	* 库房使用数据集市
	* 商品销售数据集市

### 数据仓库和数据集市的关系

> 数据仓库与数据集市的关系类似于传统关系数据库系统中的**基表与视图**的关系.数据集市的数据来自于仓库,它是数据仓库中数据的一个部分与局部,是一个数据的再抽取与组织的过程

* **自顶向下的结构**

	![image-20210101143148765](https://cyzblog.oss-cn-beijing.aliyuncs.com/image-20210101143148765.png)

	* 构建企业数据仓库 → 基于企业数据仓库构建数据集市
	* 优点：
		* 建立数据集市，减轻DW访问负载
		* 各部门可以任意处理数据
		* 数据转换和整合在DW阶段统一完成
		* 具备数据缓冲功能
	* 缺点：
		* 成本高、见效慢、数据集市间数据不可共享

* **自底向上的结构**

	![image-20210101143358396](https://cyzblog.oss-cn-beijing.aliyuncs.com/image-20210101143358396.png)

	* 构建数据集市 → 基于数据集市构建企业数据仓库
	* 优点：
		* 见效快、启动资金少
	* 缺点：
		* 各个部门都要进行数据清洗
		* 可能造成“蜘蛛网”、数据不一致
		* 总体上没有节约资金

* **总线结构的数据集市**

	![image-20210101150828674](https://cyzblog.oss-cn-beijing.aliyuncs.com/image-20210101150828674.png)

	* 不建立数据仓库而是直接建立数据集市，各个数据集市之前不是相互独立的，而是通过共享维表和事实表的总线结构紧密联系
	* 优点：
		* 共享维表和事实表，解决了建立数据仓库的许多问题
	* 缺点：
		* 基于多维模型，应用限制于OLAP
		* 多个数据源直接影响多个集市，造成数据仓库结构不稳定

* 企业级数据集市结构

## chapter5 OLAP

| 比较项目   | OLAP                   | OLTP                   |
| ---------- | ---------------------- | ---------------------- |
| 应用基础   | 数据仓库               | DBMS                   |
| 用户       | 决策者（高级管理人员） | 一般操作员（管理人员） |
| 目的       | 为决策和管理提供支持   | 为日常工作服务         |
| 数据特征   | 导出数据               | 原始数据               |
| 数据细节   | 综合性数据，细节程度低 | 细节程度高             |
| 时间特征   | 历史数据，横跨一个时段 | 当前数据               |
| 更新方法   | 周期性刷新             | 可实时更新             |
| 数据量需求 | 一次处理需大量数据     | 一次处理需少量数据     |

### 基本概念

* **度量值**：在分析型应用中，最终用户所关心和分析的对象

	* 例如，销售金额，成本，库存数量，消费金额等

* **维**：观察度量值的维度

	* 例如，可以从三个维观察销售金额这个度量值
		* 时间维：不同时间段
		* 地域维：根据每个连锁店所在的地域统计
		* 商品维：每一类商品

* **层**：反映了对度量值的观察深度

	* 同一个维度可以存在若干层，并且可以采用不同“层”次划分方法
		* 时间维：日月季年、日周年
		* 地域维：市省国洲

* **维成员**：维的一个取值成为一个“维成员”

	* 如果一个维是多层次的，则该维的“维成员”可以是     

		- 在不同维层次上取值的组合

			例如，对有日月年三个层次的时间维，维成员可以是1988年，1月，1988年1月，1月1日，1988年1月1日...

		- 在某个维层次上的取值

			例如，地域维中的江苏、南京...

* **多维数组**

	* （维1，维2，···，变量（表示我们所要观察的度量值））

* **数据单元（单元格）**

	* 多维数组可以被看成是一个根据多个下标进行定位的值的集合
	* 当多维数组的每一维都选中一个维成员， 这些维成员的组合就唯一确定了一个度量值，即：（维成员1，维成员2，……，维成员n，度量值）
	* 这样一个值或存放该值的地方我们称其为一个“数据单元”

### OLAP的数据构造方式

* **ROLAP（relational OLAP）**
	* 用RDBMS（关系数据库管理系统）管理，将星型（雪花）模式用二维表形式存储，表间用关键字相连，从而构成一个关系模式，称为ROLAP
	* 查询操作被改写成RDBMS中的查询操作
* **MOLAP（multi-dimensional OLAP）**
	* 用“多维数据库管理系统”管理，多维数据库采用的基本数据模 式就是“多维数组”
	* “事实表”被表示成为一个“多维数组”，维被映射为多维数组的下标，度量值则是多维数组的取值
* **HOLAP**
	* 混合联机分析处理
	* 试图将ROLAP和MOLAP进行融合

![img](https://cyzblog.oss-cn-beijing.aliyuncs.com/{11F3BB97-AAAC-F6B5-77AA-3261F3EF8DD6}.png)

### OLAP基本数据模型

* MOLAP
	
	* 多维数据库，类似多维数组的存储方式
* ROLAP
	* **星形模型**
		* 星型模式是一种多维表结构，它一般由两种不同性质的二维表组成     
			- 事实表（fact table）：它存放多维表中的主要事实，我们称其为量（Measure）
			- 维表（Dimension Table）：用以存放多维表中的维成员的取值
		* 一般一个n维的多维表往往有n个维表和一个事实表，它们构成了一个星形结构，因而称其为星型模式
	* **雪花模型**
		* 雪花模型是对星型模型的维表进一步层次化，原来的各维表可能被扩展为小的事实表，形成一些局部的“层次”区域
		* 优点：最大限度地减少数据存储量，使维表尽可能地规范化
		* 缺点：执行查询需要更多的连接操作，可能会影响查询性能
	
	> 使用雪花模型的三种情况
	>
	> 1. 星型模型过于复杂
	> 2. 某个属性维度是一个公共维度
	> 3. 当前星型模型的维表大小超出接受范围

### 数据立方体

- 数据仓库的数据模式通常可以看成是定义在多个数据源上的数据视图，其中存储的分析型数据通常是一些经过统计而获得的综合性数据
- 为了提高对统计信息的查询速度，我们可以预先计算好数据视图中的统计信息并保存在数据仓库中，这称为 “物化视图”，即将虚的视图转变成实际的视图。
- **存放物化视图的三维数据模型叫“数据立方体“**

* 数据超立方体
	* 大于等于四位，称为”数据超立方体“

### 多维数据分析

> 多维分析是指对以多维形式组织起来的数据采取***切片、切块、旋转、钻取***等各种分析动作，以求剖析数据，使最终用户能**从多个角度、多个侧面地观察数据**，从而**深入地了解被包含在数据中的信息、内涵**。

- **切片（Slice）**
	- 根据某一维上的某个维成员值选择统计数据进行分析
- **切块（Dice）**
	- 根据某一维上的某个维成员取值的区间选择统计数据进行分析
	- 根据多个维度上的维成员取值的区间选择统计数据进行分析
- **数据概括（roll up上钻）**
	- 将多维下标的取值提高到较高的概念层次上，从而形成新的统计查询结果，并进行分析
- **数据细化（drill down下钻）**
	- 将多维下表的取值降低到较低的概念层次上，从而形成更细致的统计查询结果，并进行分析

## chapter6 数据仓库设计

### 设计原则

* 面向主题原则
* 数据驱动原则
* 原型法设计原则

### 面向主题原则

* 建立数据仓库的目的 
	* 建数据仓库的目的是面向企业的管理人员，为经营管理提供决策支持信息。因此数据仓库的组织设计必须以用户决策的需要来确定，即从用户决策的主观需求（主题）开始。
* 数据仓库中数据的组织方法 
	* 为了进行数据分析首先要有分析的主题，以主题为起始点，进行相关数据的设计，最终建立起一个面向主题的分析型环境。 
	* 在数据库设计中则是以客体（Object）为起始点，即以客观操作需求为设计依据。

### 数据驱动原则

在数据仓库设计中，由于其所有数据均应建立在已有的数据库基础上，即是从已经存在于操作型环境中的数据出发进行数据仓库的设计，这种设计方法被称为 “数据驱动” 方法

### 原型法设计原则

从构建系统的基本框架着手，不断丰富与完善整个系统

* 不断变化的分析需求
	* 数据仓库系统的原始需求不明确，且不断变化与增加，开发者最初并不能确切了解到用户的明确而详细的需求
* 逐步求精的设计过程
* 启发方式
	* 一个迭代的开发依赖于上一个迭代所获得的结果

### 三级数据模型

* **概念模型** 
	* 为一定目标设计系统、收集信息而服务的概念型工具，是客观世界到机器世界的一个中间层次
	* E‐R 法

* **逻辑模型**
	* 描述了数据仓库的主题的逻辑实现
	* 关系模型

* **物理模型**
	* 逻辑模型在数据仓库中的实现

### 设计步骤

1. 系统规划

	* 明确主题
	* 技术准备

2. 概念设计

	* 确定系统边界
	* 确定主要的主题及其内容（分析对象、每个属性的取值情况等）
	* OLAP等分析应用设计
	* ER图

3. 逻辑设计

	* ER图 → 数据库中的二维表
	* 定义数据源和数据抽取规则

4. 物理设计

	见下

5. 数据仓库生成

6. 数据仓库的运行与维护

### 物理模型设计

在逻辑模型设计基础上确定数据的存储结构、确定索引策略、确定存储分配及数据存放位置等与物理有关的内容，物理模型设计的具体方法与数据库设计中的大致相似。其目的是为了提高数据仓库系统的访问性能。常用的一些技术有：

* 合并表
	* 减少表连接操作
* 建立数据序列
	* 考虑创建一个数据序列，这样如果数据存放在一行中，那么一次 I/O 就足以检索到了
* 引入冗余
	* 减少一次分析过程需要访问的表的数量
* 表的物理分割 
	* 对于访问频率较高的属性，可以单独考虑其物理存储组织，以便选择合适的索引策略和特定的物理组织方式。 
	* 对于需要频繁更新的属性，也可以单独组织其物理存储，以免因数据更新而带来的空间重组、重构等工作
* 生成导出数据
	*  在原始、细节数据的基础上进行一些统计和计算，生成导出数据，并保存在数据仓库中
* 建立广义索引
	* 用于记录数据仓库中数据与“最”有关的数据统计结果的索引被称为广义索引，如月销售额最差的店...
	* 这样的广义索引的数据量是非常小的，可以在每次进行数据仓库数据加载工作时生成或刷新这样的广义索引。用户可以从已经建立的 广义索引里直接获取这些统计信息，而不必对整个数据仓库进行扫描

## chapter7 多维建模1

 ### 事实表

* 每一事实表都对应着一个或若干个‘度量值’ 
	* 度量值是事实表的核心，也是趋势分析的对象 
	* 通过事实表来记录维度值与度量值之间的关系  
* 事实表中的一行对应一个度量值 
	* 事实表中的所有度量值必须具有相同的粒度 
	* 粒度划分：**事务，周期快照，累积快照**

### 度量值

* 最常用的度量值：数值类型
* 很少采用文本形式
* 三种类型度量值
	* 可做加法
	* 可沿着某种维度做加法
	* 不能做加法

### 设计过程

1. 选取要建模的业务处理过程 
	* 分析需要 
2. 定义业务处理的粒度 
	* 事实表中每一行的度量值的取值粒度 
3. 选择事实表中的维度 
4. 选择事实表中的度量值 
	* 分析对象 
	* 可以有多个度量值 
5. 通过计算而获得的可加性度量值也应该物理存储在事实表中，如：毛利润金额 
6. 不具有可加性的计算结果则应该由数据存取工具在访问过程中进行计算，如：毛利润率，单价，……